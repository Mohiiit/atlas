<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Module 04 - Perpetuals</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#fff5f5;--surface:#fff;--text:#3f1010;--dim:#7e3d3d;--border:#f0caca;--accent:#b91c1c}
@media (prefers-color-scheme: dark){:root{--bg:#1f0f12;--surface:#2a151a;--text:#ffe5e5;--dim:#d69a9a;--border:#4a232a;--accent:#fb7185}}
*{box-sizing:border-box}body{margin:0;font-family:'Chakra Petch',sans-serif;background:radial-gradient(circle at 75% 20%, rgba(185,28,28,.18), transparent 35%),var(--bg);color:var(--text);padding:28px}
main{max-width:1100px;margin:0 auto}.row{display:grid;grid-template-columns:1.25fr .75fr;gap:16px}@media(max-width:900px){.row{grid-template-columns:1fr}}.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px}
h1{margin:0;font-size:34px}.sub{margin:6px 0 18px;color:var(--dim);font:12px 'Source Code Pro',monospace}label{display:block;color:var(--accent);font:11px 'Source Code Pro',monospace;text-transform:uppercase;margin-bottom:10px}ul{margin:8px 0 0 18px;color:var(--dim)}li{margin:7px 0}code{font-family:'Source Code Pro',monospace;background:rgba(185,28,28,.12);padding:2px 6px;border-radius:4px}
</style></head><body><main>
<h1>Module 04: Perps from First Principles</h1><p class="sub">PnL, funding, margin, and liquidation engine</p>
<div class="row"><section class="card"><label>Perp Risk Loop</label><pre class="mermaid">flowchart TD
  A[Open position with collateral] --> B[Mark price updates]
  B --> C[Unrealized PnL recalculated]
  C --> D[Equity vs maintenance margin]
  D -->|safe| E[Position stays open]
  D -->|unsafe| F[Liquidation engine]
  F --> G[Insurance fund / ADL path]
  E --> H[Funding transfer longs<->shorts]
  H --> B
</pre></section>
<section class="card"><label>10x Example</label><ul>
<li>Long 1 BTC at 60,000 with 6,000 collateral.</li>
<li>Price to 57,000 => PnL <code>-3,000</code>.</li>
<li>Equity = <code>6,000 - 3,000 = 3,000</code>.</li>
<li>If maintenance margin is 3,500 => liquidatable.</li>
</ul>
<label style="margin-top:14px">Funding Check</label><ul>
<li>Funding +0.01%/8h on 60,000 notional.</li>
<li>Long pays <code>6</code> each interval.</li>
<li>Persistent premium drains leveraged longs.</li>
</ul></section></div>
</main>
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';const d=window.matchMedia('(prefers-color-scheme: dark)').matches;mermaid.initialize({startOnLoad:true,theme:'base',themeVariables:{primaryColor:d?'#3c1e25':'#ffe9e9',primaryBorderColor:d?'#fb7185':'#b91c1c',primaryTextColor:d?'#ffe5e5':'#3f1010',lineColor:d?'#fecaca':'#7e3d3d',fontFamily:'Chakra Petch',fontSize:'15px'}});</script>
</body></html>
